<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Car Game - Mobile Friendly</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: #111;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }

    #game {
      width: 400px;
      height: 600px;
      background-image: url('road1.png');
      background-size: cover;
      background-repeat: repeat-y;
      overflow: hidden;
      position: relative;
      border: 4px solid black;
    }

    .car, .enemy {
      width: 25px;
      height: 50px;
      position: absolute;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }

    .car { bottom: 20px; left: 187.5px; z-index: 10; background-image: url('mahi.png'); }
    .enemy { background-image: url('encar.png'); }

    #score, #highScore {
      position: absolute;
      top: 10px;
      color: white;
      font-size: 16px;
      z-index: 20;
    }

    #score { left: 10px; }
    #highScore { right: 10px; color: yellow; }

    #countdown {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      font-size: 60px;
      color: white;
      display: none;
      z-index: 30;
    }

    #controls {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
    }

    .btn {
      width: 60px;
      height: 60px;
      font-size: 24px;
      border: none;
      background: #333;
      color: white;
      border-radius: 50%;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div id="game">
  <div id="score">Score: 0</div>
  <div id="highScore">High Score: 0</div>
  <div id="countdown">3</div>
  <div class="car" id="playerCar"></div>
</div>

<!-- Touch controls -->
<div id="controls">
  <button class="btn" onclick="moveLeft()">‚¨ÖÔ∏è</button>
  <button class="btn" onclick="togglePause()">‚è∏Ô∏è</button>
  <button class="btn" onclick="moveRight()">‚û°Ô∏è</button>
</div>

<!-- Sounds -->
<audio id="crashSound" src="crash.mp3"></audio>
<audio id="offroadSound" src="offroad.mp3"></audio>

<script>
  const game = document.getElementById("game");
  const playerCar = document.getElementById("playerCar");
  const scoreDisplay = document.getElementById("score");
  const highScoreDisplay = document.getElementById("highScore");
  const countdown = document.getElementById("countdown");
  const crashSound = document.getElementById("crashSound");
  const offroadSound = document.getElementById("offroadSound");

  const gameWidth = 400;
  let playerX = 187.5;
  let baseSpeed = 5;
  let speed = baseSpeed;
  let score = 0;
  let highScore = parseInt(localStorage.getItem("highScore")) || 0;
  let gameRunning = false;
  let gamePaused = false;
  let offRoad = false;
  let bgPositionY = 0;
  let keys = { ArrowLeft: false, ArrowRight: false };

  highScoreDisplay.textContent = "High Score: " + highScore;

  const roadLeft = 100;
  const roadRight = 275;

  document.addEventListener("keydown", (e) => {
    if (e.code === "ArrowLeft") keys.ArrowLeft = true;
    if (e.code === "ArrowRight") keys.ArrowRight = true;
  });

  document.addEventListener("keyup", (e) => {
    if (e.code === "ArrowLeft") keys.ArrowLeft = false;
    if (e.code === "ArrowRight") keys.ArrowRight = false;
  });

  function moveLeft() {
    if (playerX > 0) playerX -= 5;
    playerCar.style.left = playerX + "px";
  }

  function moveRight() {
    if (playerX < gameWidth - 25) playerX += 5;
    playerCar.style.left = playerX + "px";
  }

  function createEnemyCar() {
    const enemy = document.createElement("div");
    enemy.classList.add("enemy");
    enemy.style.top = "-60px";
    enemy.style.left = `${Math.floor(Math.random() * (gameWidth - 25))}px`;
    game.appendChild(enemy);
  }

  function moveEnemies() {
    const enemies = document.querySelectorAll(".enemy");
    enemies.forEach(enemy => {
      let top = parseFloat(enemy.style.top);
      enemy.style.top = (top + speed) + "px";

      if (isColliding(playerCar, enemy)) {
        crashSound.play();
        triggerVibration();
        stopGame();
      }

      if (top > 600) {
        enemy.remove();
        score++;
        scoreDisplay.textContent = "Score: " + score;
        if (score > highScore) {
          highScore = score;
          localStorage.setItem("highScore", highScore);
          highScoreDisplay.textContent = "High Score: " + highScore;
        }
        if (score % 5 === 0 && !offRoad) speed += 1;
      }
    });
  }

  function isColliding(a, b) {
    const aRect = a.getBoundingClientRect();
    const bRect = b.getBoundingClientRect();
    return !(
      aRect.bottom < bRect.top ||
      aRect.top > bRect.bottom ||
      aRect.right < bRect.left ||
      aRect.left > bRect.right
    );
  }

  function movePlayer() {
    if (keys.ArrowLeft && playerX > 0) playerX -= 5;
    if (keys.ArrowRight && playerX < gameWidth - 25) playerX += 5;
    playerCar.style.left = playerX + "px";
  }

  function checkOffRoad() {
    const carLeft = playerX;
    const carRight = playerX + 25;
    if (carLeft < roadLeft || carRight > roadRight) {
      if (!offRoad) {
        triggerVibration();
        offroadSound.play();
        speed = baseSpeed / 2;
        offRoad = true;
      }
    } else {
      if (offRoad) {
        speed = baseSpeed;
        offRoad = false;
      }
    }
  }

  function scrollBackground() {
    bgPositionY += speed;
    game.style.backgroundPositionY = `${bgPositionY}px`;
  }

  function gameLoop() {
    if (!gameRunning || gamePaused) return;
    handleGamepad();
    movePlayer();
    scrollBackground();
    checkOffRoad();

    if (Math.random() < 0.03) createEnemyCar();
    moveEnemies();

    requestAnimationFrame(gameLoop);
  }

  function startGame() {
    score = 0;
    speed = baseSpeed;
    playerX = 187.5;
    playerCar.style.left = playerX + "px";
    scoreDisplay.textContent = "Score: 0";
    bgPositionY = 0;
    document.querySelectorAll(".enemy").forEach(e => e.remove());
    gameRunning = true;
    gamePaused = false;
    requestAnimationFrame(gameLoop);
  }

  function stopGame() {
    gameRunning = false;
    alert("üí• Game Over! Your Score: " + score);
    showCountdown(() => startGame());
  }

  function togglePause() {
    if (!gameRunning) return;
    gamePaused = !gamePaused;
    if (!gamePaused) requestAnimationFrame(gameLoop);
  }

  function showCountdown(callback) {
    let count = 3;
    countdown.textContent = count;
    countdown.style.display = "block";
    const interval = setInterval(() => {
      count--;
      if (count === 0) {
        clearInterval(interval);
